\documentclass[../Marcus.tex]{subfiles}

\begin{document}

\chapter{Prime Decomposition in Number Rings}

\subsection*{Exercise 3.1}

$(1)\Rightarrow(1')$ Suppose every ideal is finitely generated. Given any ascending chain of ideals $I_1\sbe I_2\sbe I_3\sbe\cdots$. Let $\Ical:=\cup_{k=1}^\infty I_k$. It's easy to check that $\Ical$ is also an ideal of $R$ and hence it's finitely generated. Write $\Ical=Rr_1+\cdots+Rr_n$ where $r_i\in I_{k_i}$. WLOG, we may assume $I_{k_i}\sbe I_{k_{i+1}}$ $\forall i=1,\ldots,n-1$. 

We claim that $\Ical=I_{k_n}$. Clearly, $\Ical\spe I_{k_n}$. Conversely, since for each $i$ we have $r_i\in I_{k_i}\sbe I_{k_n}$, so $Rr_i\sbe I_{k_n}$ and thus $\Ical\sbe I_{k_n}$. This completes the claim.

Since for each $k\geq k_n$, we have $I_k\sbe \Ical=I_{k_n}$ and $I_k\spe I_{k_n}$. So $I_k=I_{k_n}$ for all $k\geq k_n$. This means the ascending chain of ideals $I_1\sbe I_2\sbe I_3\sbe\cdots$ is stationary.

$(1')\Rightarrow(1'')$ Suppose the ascending chain condition holds. If there exists a non-empty set $S$ of ideals s.t. $S$ has no maximal elements. Then for any $I\in S$, $\exists I'\in S$ s.t. $I\sbne I'$. Inductively we will get a non-stable ascending chain of ideals, a contradiction.

$(1'')\Rightarrow(1)$ Suppose every non-empty set of ideals has a maximal element. Given an ideal $I$ of $R$. Consider the set of ideals $S:=\{Rr_1+\cdots+Rr_n\mid r_1,\ldots,r_n\in I, n\in\NN\}$. Then by assumption there exists a maximal element in $S$, say $Rr_1+\cdots+Rr_n \in S$. We claim that $Rr_1+\cdots+Rr_n=I$. (So $I$ is finitely generated.)

$Rr_1+\cdots+Rr_n\sbe I$ is clear. Conversely, if $\exists r'\in I$ and $r'\notin Rr_1+\cdots+Rr_n$, then we will have $Rr_1+\cdots+Rr_n+Rr' \in S$ and $Rr_1+\cdots+Rr_n \sbne Rr_1+\cdots+Rr_n+Rr'$. This contradicts to the maximality.

\subsection*{Exercise 3.2}

Let $R$ be a finite integral domain with $\#(R)=m$. Given $0\neq\alpha\in R$, consider the $m+1$ elements $\alpha,\alpha^2,\alpha^3,\ldots,\alpha^{m+1}\in R$. Then by pigeonhole principle we must have $\alpha^i=\alpha^j$ for some $1\leq i<j \leq m+1$. And since $R$ is an integral domain, so we can use the cancellation law to obtain $\alpha^{j-i}=1$. This shows that $\alpha^{j-i-1}$ is the multiplicative inverse of $\alpha$.

\subsection*{Exercise 3.3}

Write $G=\ZZ\beta_1\oplus\cdots\oplus\ZZ\beta_n$. Consider the natural group homomorphism $\phi:\ZZ\beta_1\oplus\cdots\oplus\ZZ\beta_n \to (\ZZ/m\ZZ)\beta_1\oplus\cdots\oplus(\ZZ/m\ZZ)\beta_n$. It's easy to see that $\phi$ is surjective and $\ker\phi=mG$. So $G/mG\simeq (\ZZ/m\ZZ)\beta_1\oplus\cdots\oplus(\ZZ/m\ZZ)\beta_n$ where each $(\ZZ/m\ZZ)\beta_i$ is a cyclic group of order $m$.

\subsection*{Exercise 3.4}

Fix an integral basis $\{\beta_1,\ldots,\beta_n\}$ of $R$. Since $I \sbe R$, we know $I$ is a free abelian group of rank at most $n$. On the other hand, we take any  $0 \neq \alpha \in I$. From $I \spe (\alpha)=\alpha R = \alpha(\ZZ\beta_1\oplus\cdots\oplus\ZZ\beta_n) = \ZZ\alpha\beta_1\oplus\cdots\oplus\ZZ\alpha\beta_n$ we know $I$ has rank at least $n$. So the result follows.

\subsection*{Exercise 3.5}

\subsection*{Exercise 3.6}

\subsection*{Exercise 3.7}

Fix $m,n\in\NN$ and write $1=\alpha+\beta$ where $\alpha\in I,\beta\in J$. Raising both sides to $m+n$ powers and using binomial theorem, we have
\begin{multline*}
    1=\alpha^{m+n}+\binom{m+n}{1}\alpha^{m+n-1}\beta+\cdots+\binom{m+n}{n}\alpha^m\beta^n \\ +\binom{m+n}{n+1}\alpha^{m-1}\beta^{n+1}+\cdots+\binom{m+n}{m+n-1}\alpha\beta^{m+n-1}+\beta^{m+n}.
\end{multline*}
This expression can be written as $\alpha^m\cdot\jk + \beta^n\cdot\jk$ and hence $1\in I^m+J^n$.

\subsection*{Exercise 3.8}

\subsection*{Exercise 3.9}

(a) Write $I=I_1^{\alpha_1}\cdots I_s^{\alpha_s}$ and $J=J_1^{\beta_1}\cdots J_t^{\beta_t}$ into prime factorizations in $R$. Then
\begin{align*}
    IS &= (I_1S)^{\alpha_1}\cdots (I_sS)^{\alpha_s}=(I_{11}\cdots I_{1n_1})^{\alpha_1}\cdots (I_{s1}\cdots I_{sn_s})^{\alpha_s}, \\
    JS &= (J_1S)^{\beta_1}\cdots (J_tS)^{\beta_t}=(J_{11}\cdots J_{1m_1})^{\beta_1}\cdots (J_{t1}\cdots J_{tm_t})^{\beta_t},
\end{align*}
where all primes are now in $S$.

We first claim that $I_{ik}\neq I_{i'k'}$ if $i\neq i'$. Otherwise, if $I_{ik}=I_{i'k'}$, then since $I_{ik}$ lies over $I_i$ and $I_{i'k'}$ lies over $I_{i'}$, we have $I_{ik}$ also lies over $I_{i'}$. By Theorem 20 (p. 45), we must have $I_i=I_{i'}$, a contradiction. This means if two primes come from different $I_iS$, they must be different.

Since $IS\mid JS$, by rearranging appropriately, we may assume $I_{11}=J_{11}$. Since $I_{11},J_{11}$ lie over $I_1,J_1$, respectively. By Theorem 20 again, we have $I_1=J_1$.

We next claim that for each fixed $k$, one has that $I_{ik}=J_{1k'}$ for some $k'$ iff $i=1$. Assume $I_{ik}=J_{1k'}$. Then $I_{ik}$ lies over $I_i$ and $J_1(=I_1)$. So we have $i=1$. Conversely, assume $i=1$. Since $IS\mid JS$, $I_{1k}$ must be some $J_{i'k'}$. And since $I_{1k}$ lies over $I_1(=J_1)$ and $J_{i'}$. So we know $i'=1$ and hence $I_{1k}=J_{1k'}$ for some $k'$.

Note that from our two claims together with $IS\mid JS$, we have $\alpha_1\leq \beta_1$. And by repeating this argument, the result follows.

(b) Take $J:=IS\cap R$. It's easy to see that $J$ is an ideal in $R$. Moreover, from 
$$
JS = (IS\cap R)S \sbe IS^2\cap RS = IS\cap S = IS,
$$
we have $IS\mid JS$. So by (a), we have $I\mid J$. Hence $J=IS\cap R\sbe I$. Conversely, $I\sbe IS\cap R$ is clear. So we have $I=IS\cap R$.

(c) We claim that $I=(I\cap R)S$ iff $I=JS$ for some ideal $J$ in $R$.

$(\Rightarrow)$ Just take $J=I\cap R$ and done.

$(\Leftarrow)$ By (b), we have $(I\cap R)S = (JS\cap R)S = JS = I$.

\subsection*{Exercise 3.10}

Let $e=e(U/P),e_1=e(U/Q),e_2=e(Q/P)$. Then we have $QT=U^{e_1}\cdot\jk1$ and $PS=Q^{e_2}\cdot\jk2$. So 
$$
PT = PST = Q^{e_2}\cdot\jk2\cdot T = (QT)^{e_2}\cdot\jk2 = U^{e_1e_2}\cdot(\jk1)^{e_2}\cdot\jk2.
$$

It's remaining to show that $U \nmid \jk1 , \jk2$, or equivalently, $\jk1,\jk2 \nsbe U$. For $\jk1$, this follows easily from the definition. For $\jk2$, let $Q_i\subset S$ be any prime divisor of $\jk2$ (so in particular $Q_i \neq Q$), we want to show that $Q_i \nsbe U$. But if $Q_i \sbe U$, then $U$ lies over $Q_i$. And since $U$ lies over $Q$, so by Theorem 20 (p. 45), we have $Q=Q_i$, a contradiction.

For the inertial degree, we may consider the tower of field extensions $R/P\subset S/Q\subset T/U$ and use the fact that $[T/U:R/P]=[T/U:S/Q]\cdot[S/Q:R/P]$.

\subsection*{Exercise 3.11}

From Theorem 22 (c) (p. 46) we know $\|(\alpha)\|=|\Nr(\alpha)|$. And since $(\alpha)\sbe I \sbe R$, so by the third isomorphism theorem, we have $(R/(\alpha))/(I/(\alpha))\simeq R/I$. This implies 
$$
\#(R/I)\cdot\#(I/(\alpha))=\#(R/(\alpha)).
$$ 
Hence $\|I\|=\#(R/I)\mid \#(R/(\alpha))=\|(\alpha)\|=|\Nr(\alpha)|$. And the equality holds iff $\#(I/(\alpha))=1$ iff $I=(\alpha)$.

\subsection*{Exercise 3.12}

\subsection*{Exercise 3.13}

\subsection*{Exercise 3.14}

In this exercise, we will put $(*)$ whenever we quote Exercise 3.9 (b). Moreover, in parts (a) and (b), we will denote $e:=e(Q/P)$ and $f:=f(Q/P)$. We also assume $PS=(Q_1\cdots Q_r)^e$ where $Q_i$ are distinct primes. (Note that by the Corollary of Theorem 23 (p. 50), we have $e=e(Q_i/P)$ and $f=f(Q_i/P)$ for all $i=1,\ldots,r$.)

(a) By Theorem 23 (p. 49), there exists $\phi\in G$ s.t. $\phi(Q)=Q'$. Define the map
$$
\begin{array}{ccc}
    \{\sigma\mid \sigma(Q)=Q\} & \longleftrightarrow & \{\tau\mid \tau(Q)=Q'\} \\
    \sigma & \longmapsto & \phi\circ\sigma \\
    \phi^{-1}\circ\tau & \longmapsfrom & \tau.
    \end{array}
$$
It's easy to see that this is a bijection. So these two sets have the same cardinality.

Write $G=\cup_{i=1}^r \Gcal_i$ where $\Gcal_i:=\{\sigma\mid \sigma(Q_1)=Q_i\}$. This is clearly a disjoint union and we've shown in the first step that all $\Gcal_i$ have the same cardinality, let's call it $g$. So $n=\#(G)=rg$. And since $n=ref$, we have $g=ef$.

(b) By $(*)$,
$$
P^f=R\cap P^fS=R\cap(PS)^f=R\cap(Q_1\cdots Q_r)^{ef}.
$$
So it's remaining to show $(Q_1\cdots Q_r)^{ef}=\prod_{\sigma\in G}\sigma(Q)$. WLOG, we assume $Q=Q_1$. From (a) we know there are $ef$ $\sigma$'s sending $Q_1$ to $Q_i$ for all $i=1,\ldots,r$. So $\prod_{\sigma\in G}\sigma(Q_1)=Q_1^{ef}\cdots Q_r^{ef}=(Q_1\cdots Q_r)^{ef}$.

(c) Write $I=I_1\cdots I_s$ where $I_i$ are prime in $S$. Each $I_i$ lies over a unique prime ideal in $R$, say $J_i$. For each $i$, let $e_i:=e(I_i/J_i)$ and $f_i:=f(I_i/J_i)$. Then $J_iS=(I_i\cdot\jk)^{e_i}$. So similar to (b), we have 
$$
\prod_{\sigma\in G}\sigma(I_i)
= \sigma_1(I_i)\cdots\sigma_n(I_i)
= (I_i\cdot\jk)^{e_if_i}
= (J_iS)^{f_i}=J_i^{f_i}S.
$$

Let $J:=\prod_{i=1}^s J_i^{f_i}$ be the ideal in $R$, then
$$
\prod_{\sigma\in G}\sigma(I)
= \prod_{\sigma\in G}\sigma(I_1)\cdots\sigma(I_s)
= \prod_{i=1}^s\left(\prod_{\sigma\in G}\sigma(I_i)\right)
= \prod_{i=1}^s J_i^{f_i}S=JS.
$$
By $(*)$, $J=JS\cap R=\prod_{\sigma\in G}\sigma(I)\cap R=\Nr^L_K(I)$. So $JS=\prod_{\sigma\in G}\sigma(I)=\Nr^L_K(I)\cdot S$.

(d) Since the norm of an ideal in $S$ is an ideal in $R$. So
\begin{align*}
    \Nr^L_K(IJ)
	&\overset{(*)}{=} \Nr^L_K(IJ)\cdot S\cap R
	\overset{(c)}{=} \prod_{\sigma\in G}\sigma(IJ)\cap R
	= \prod_{\sigma\in G}\sigma(I)\sigma(J)\cap R   \\
    &= \prod_{\sigma\in G}\sigma(I)\prod_{\sigma\in G}\sigma(J)\cap R
	\overset{(c)}{=} \left(\Nr^L_K(I)\cdot S\right)\left(\Nr^L_K(J)\cdot S\right)\cap R   \\
    &= \Nr^L_K(I)\Nr^L_K(J)S\cap R
	\overset{(*)}{=} \Nr^L_K(I)\Nr^L_K(J).
\end{align*}

(e) We will use the fact that $\Nr^L_K(\alpha)\in R$.
\begin{align*}
    \Nr^L_K((\alpha))
	&= \Nr^L_K(\alpha S)
	\overset{\df}{=} R\cap \prod_{\sigma\in G}\sigma(\alpha S)
	= R\cap \prod_{\sigma\in G}\sigma(\alpha)\sigma(S)    \\
    &\overset{\df}{=} R\cap \Nr^L_K(\alpha)\cdot S
	= R\cap\left(\Nr^L_K(\alpha)\cdot R\right)\cdot S
    \overset{(*)}{=} \Nr^L_K(\alpha)\cdot R.
\end{align*}

\subsection*{Exercise 3.15}

(a) Write $I=I_1\cdots I_r$ into prime factorization in $\AA\cap M$. By Theorem 20 (p. 45), each $I_i$ lies over a unique prime ideal $Q_i$ in $\AA\cap L$, and each $Q_i$ lies over a unique prime ideal $P_i$ in $\AA\cap K$. So we have the prime ideals $P_i\subset Q_i\subset I_i$. By Exercise 3.10, $f(I_i/P_i)=f(I_i/Q_i)f(Q_i/P_i)$. So
\begin{align*}
    \Nr^L_K\left(\Nr^M_L(I)\right)
	&= \Nr^L_K\left(\Nr^M_L\left(\prod_{i=1}^r I_i\right)\right)
	= \Nr^L_K\left(\prod_{i=1}^r \Nr^M_L(I_i)\right)     \\ 
    &= \Nr^L_K\left(\prod_{i=1}^r Q_i^{f(I_i/Q_i)}\right)
	= \prod_{i=1}^r \left(\Nr^L_K(Q_i)\right)^{f(I_i/Q_i)}
	= \prod_{i=1}^r \left(P_i^{f(Q_i/P_i)}\right)^{f(I_i/Q_i)}      \\
    &= \prod_{i=1}^r P_i^{f(Q_i/P_i)f(I_i/Q_i)}
	= \prod_{i=1}^r P_i^{f(I_i/P_i)}
	= \prod_{i=1}^r \Nr^M_K(I_i)
	= \Nr^M_K(I).
\end{align*}

(b) Let $M$ be the normal closure of $L$ over $K$. Then we have a tower of field extensions $K\subset L\subset M$. By field theory since $M/K$ is normal, we have $M/L$ is also normal. Let $R,S,T$ be the number rings of $K,L,M$, respectively. Our goal is to show $\Nr^L_K(\alpha S)=\Nr^L_K(\alpha)R$.

Write $\alpha S=Q_1\cdots Q_r$ where $Q_i$ are prime in $S$. Then $\alpha S\cdot T=Q_1T\cdots Q_rT$. For each $i=1,\ldots,r$, since $M/L$ is normal, we may write $Q_iT=(I_{i1}\cdots I_{in_i})^{e_i}$ where $I_{i1},\ldots,I_{in_i}$ are prime in $T$. Let $f_i$ be the corresponding inertial degree, then by (a),
\begin{align*}
    \Nr^M_K(Q_iT)
	&= \Nr^L_K\left(\Nr^M_L(Q_iT)\right)
	= \Nr^L_K\left(\Nr^M_L\left(\prod_{k=1}^{n_i} I_{ik}^{e_i}\right)\right)    \\
    &= \Nr^L_K\left(\prod_{k=1}^{n_i}\left(\Nr^M_L (I_{ik})^{e_i}\right)\right)
	= \Nr^L_K\left(\prod_{k=1}^{n_i} Q_i^{e_if_i}\right)     \\
    &= \Nr^L_K\left(Q_i^{e_if_in_i}\right)
	= \Nr^L_K\left(Q_i^{[M:L]}\right)
	= \Nr^L_K(Q_i)^{[M:L]}.
\end{align*}
So
\begin{align*}
    \Nr^M_K(\alpha S\cdot T)
	&= \Nr^M_K\left(\prod_{i=1}^r Q_iT\right)
	= \prod_{i=1}^r \Nr^M_K(Q_iT)    \\
	&= \prod_{i=1}^r \Nr^L_K(Q_i)^{[M:L]}
    = \Nr^L_K\left(\prod_{i=1}^r Q_i\right)^{[M:L]}
	= \Nr^L_K(\alpha S)^{[M:L]}.
\end{align*}
On the other hand, since $M/K$ is normal, by Exercise 3.14 (e), we have
\begin{align*}
    \Nr^M_K(\alpha S\cdot T)
	&= \Nr^M_K(\alpha T)
	= \Nr^M_K(\alpha)R
	= \Nr^L_K\left(\Nr^M_L(\alpha)\right)R     \\
    &= \Nr^L_K\left(\alpha^{[M:L]}\right)R
	= \left(\Nr^L_K(\alpha)\right)^{[M:L]}R
	= \left(\Nr^L_K(\alpha)R\right)^{[M:L]}. 
\end{align*}
We've used the fact that $\alpha\in S$ in the fourth equality.

Combining these two gives us $\Nr^L_K(\alpha S)^{[M:L]}=(\Nr^L_K(\alpha)R)^{[M:L]}$. They are ideals in $R$. Hence $\Nr^L_K(\alpha S)=\Nr^L_K(\alpha)R$ by the unique factorization of prime ideals.

(c) First we assume $I=Q$ is a prime. Then $Q$ lies over a unique prime ideal $(p)=p\ZZ$ in $\ZZ$. Let $f=f(Q/p\ZZ)$, then $\Nr^L_\QQ(Q)=(p\ZZ)^f=p^f\ZZ=\#(S/Q)\cdot\ZZ=\|Q\|\cdot\ZZ$.

In general, write $I=Q_1\cdots Q_r$ into prime factorization. Then
\begin{align*}
	\Nr^L_\QQ(I)
	&= \Nr^L_\QQ(Q_1\cdots Q_r)
	= \Nr^L_\QQ(Q_1)\cdots\Nr^L_\QQ(Q_r)    \\
	&= \|Q_1\|\ZZ\cdots\|Q_r\|\ZZ
	= \|Q_1\cdots Q_r\|\ZZ
	= \|I\|\ZZ.
\end{align*}

\subsection*{Exercise 3.16}

(a) Define $\phi:G(S)\to G(R)$ by $\phi([I])=[\Nr^L_K(I)]$. We only need to check this is well-defined because $\phi$ is clearly a group homomorphism. Given two ideals $I,J$ in $S$ where $[I]=[J]$. Take $a,b\in S$ s.t. $aI=bJ\implies aS\cdot I=bS\cdot J\implies \Nr^L_K(aS)\Nr^L_K(I)=\Nr^L_K(bS)\Nr^L_K(J)$. And by Exercise 3.15 (b), we have $\Nr^L_K(aS)=\Nr^L_K(a)\cdot R=:(\alpha)$ and $\Nr^L_K(bS)=\Nr^L_K(b)\cdot R=:(\beta)$ where $\alpha,\beta\in R$. So $\alpha\cdot\Nr^L_K(I)=\beta\cdot\Nr^L_K(J)$ and hence $[\Nr^L_K(I)]=[\Nr^L_K(J)]$.

(b) Let $f:=f(Q/P)$. Note that $\phi([Q])=[\Nr^L_K(Q)]=[P^f]=[P]^f$, and from group theory we know $\ord(\phi([Q]))\mid \ord([Q])$. Thus
$$
d_P=\ord([P])\mid \ord([P]^f)\cdot f = \ord(\phi([Q]))\cdot f\mid \ord([Q])\cdot f=d_Q\cdot f.
$$

\subsection*{Exercise 3.17}

(a) We know $f(Q/(2))=f(Q/P)f(P/(2))$. By Theorem 25 (p. 52) we have $f(P/(2))=1$. On the other hand, by Theorem 26 (p. 53), $f(Q/(2))$ equals the order of $2$ in $(\ZZ/23\ZZ)^{\times}$, which is $11$. Thus, $f(Q/P)=11$.

By observing the degrees of the tower of field extensions $\QQ\subset \QQ(\sqrt{-23})\subset \QQ(\omega)$, we have $\phi(23)=22=[\QQ(\omega):\QQ(\sqrt{-23})]\cdot 2$, so $[\QQ(\omega):\QQ(\sqrt{-23})]=11$. And since $f(Q/P)=11$, by Theorem 21 (p. 46), we have $e(Q/P)=1$ and $P\ZZ[\omega]=(2,\theta)\ZZ[\omega]=Q$.

(b) We first show that 
$$
P^3=\left(8,2+2\sqrt{-23},-11+\sqrt{-23},\frac{-17-5\sqrt{-23}}{2}\right)=\left(\frac{-3+\sqrt{-23}}{2}\right)=(\theta-2).
$$ 
This is straightforward by simple calculation, observe that
\begin{align*}
    2+2\sqrt{-23} &= \left(\frac{-3+\sqrt{-23}}{2}\right)\left(\frac{5-\sqrt{-23}}{2}\right), \\
    \frac{-17-5\sqrt{-23}}{2} &= \left(\frac{-3+\sqrt{-23}}{2}\right)(-2+\sqrt{-23}),
\end{align*}
and on the other hand, 
$$
\frac{-3+\sqrt{-23}}{2}=(8)(-4)+(-11+\sqrt{-23})(-2)+\left(\frac{-17-5\sqrt{-23}}{2}\right)(-1),
$$ 
So we have $P^3=(\theta-2)$.

We next show that $P$ is not principal in $R$, if $P=(2,\theta)=(\alpha)=\alpha R$ is principal, then by Theorem 22(c) (p. 46), $\|(\alpha)\|=|\Nr^K_\QQ(\alpha)|$. It's easy to see that $\|(\alpha)\|=\#(R/(2,\theta))=2$. (See the argument on p. 42.) So $\Nr^K_\QQ(\alpha)=\pm 2$.

On the other hand, since $\alpha\in R$, write $\alpha=a+b((1+\sqrt{-23})/2)$ where $a,b\in\ZZ$. So $\Nr^K_\QQ(\alpha)=a^2+ab+6b^2=\pm 2$. We claim that this is impossible by showing that this equation has no integral solutions.

Suppose $(a,b)$ is an integral solution, if none of $a,b$ is zero, then $a^2+6b^2\geq 7$, so $\pm2 = a^2+ab+6b^2 \geq 7+ab$. From this we get $-ab\geq 5,9$. Observe that 
$$
\pm2 = a^2+ab+6b^2 = (a+b)^2+5b^2-ab \geq -ab \geq 5,9,
$$
This is a contradiction, so we have at least one of $a,b$ is zero. But this is impossible by simple calculation. Hence $a^2+ab+6b^2=\pm2$ has no integral solutions.

(c) If $Q$ is principal, then $[Q]$ is the identity element in $G(\ZZ[\omega])$. By (a) and Exercise 16(b), $d_P\mid d_Q\cdot f(Q/P)=1\cdot 11$. So $d_P=1,11$. By (b) we have $P$ is not principal, so $d_P=11$. This is a contradiction because by (b) we know $[P]^3=[(\theta-2)]$ so $d_P=3$.

(d) By (a) we know $f(Q/P)=11$. And since $2\nmid 23$, by the Corollary of Theorem 26 (p. 54), $2\ZZ[\omega]=(\alpha\beta)=(\alpha)(\beta)$ is the product of two prime ideals. We know one of them is $Q$. And by (c), $Q$ is not principal, so $Q\neq (\alpha)$ and $Q\neq(\beta)$. This means one of $(\alpha),(\beta)$ must be able to be factorized further. WLOG, say $(\alpha)$. So $(\alpha)=QQ'$ for some $Q'$. In this case, $(\beta)=\ZZ[\omega]$, i.e., $\beta$ is a unit.

\subsection*{Exercise 3.18}

Let $\sigma_1,\ldots,\sigma_n$ be the $n$ embeddings of $K$ into $\CC$. For each $j=1,\ldots,n$, we write $\sigma(\alpha_j):=(\sigma_1(\alpha_j),\ldots,\sigma_n(\alpha_j))^T\in K^n$.

(a) We use the fact that the determinant is multilinear. Thus,
\begin{align*}
    \disc(r\alpha_1,\alpha_2,\ldots,\alpha_n) &= |\sigma(r\alpha_1),\sigma(\alpha_2),\ldots,\sigma(\alpha_n)|^2 \\
    &= |r\sigma(\alpha_1),\sigma(\alpha_2),\ldots,\sigma(\alpha_n)|^2 \\
    &= r^2|\sigma(\alpha_1),\sigma(\alpha_2),\ldots,\sigma(\alpha_n)|^2 \\
    &= r^2\disc(\alpha_1,\ldots,\alpha_n).
\end{align*}

(b) We use the fact that the determinant remains unchanged under the operation of adding a scalar multiple of one column to another column. Since $\beta$ is a linear combination of $\alpha_2,\ldots,\alpha_n$ over $\QQ$. We know $\sigma_i(\beta)$ is a linear combination of $\sigma_i(\alpha_2),\ldots,\sigma_i(\alpha_n)$ over $\QQ$ for all $i$. Thus,
\begin{align*}
    \disc(\alpha_1+\beta,\alpha_2,\ldots,\alpha_n) &= |\sigma(\alpha_1+\beta),\sigma(\alpha_2),\ldots,\sigma(\alpha_n)|^2 \\
    &=|\sigma(\alpha_1)+\sigma(\beta),\sigma(\alpha_2),\ldots,\sigma(\alpha_n)|^2  \\
    &= |\sigma(\alpha_1),\sigma(\alpha_2),\ldots,\sigma(\alpha_n)|^2 \\
    &= \disc(\alpha_1,\ldots,\alpha_n).
\end{align*}

\subsection*{Exercise 3.19}

(a) Assume $\alpha\notin PS$. Since $S/PS$ is a vector space over $R/P$ with dimension $n=[L:K]$ (see p. 48). Let $\{\gamma_1,\ldots,\gamma_n\}\subset S$ s.t. the corresponding elements in $S/PS$ form a basis of $S/PS$ over $R/P$. Since $\alpha\notin PS$, we may write $\alpha=c_1\gamma_1+\cdots+c_n\gamma_n$ where not all $c_i \equiv 0 \pmod{P}$. Denote it as $c_{i_0}$, i.e., $c_{i_0}\notin P$. On the other hand, from $\alpha\beta=c_1\beta\gamma_1+\cdots+c_n\beta\gamma_n$ and since $\alpha\beta\in PS$, we have $c_i\beta \equiv 0 \pmod{P}$ $\forall i$. In particular, $c_{i_0}\beta\equiv 0 \pmod{P}$. So $c_{i_0}\beta\in P$. Since $P$ is a prime ideal and $c_{i_0}\notin P$, we have $\beta\in P$.

We provide another proof using the fact that $P$ is a maximal ideal of $R$. Assume $\beta\notin P$. By maximality of $P$ we have $R=P+(\beta)$. Write $1=p+\beta r$ where $p\in P,r\in R$. Then $\alpha=p \alpha+\alpha\beta r$. Note that $p\alpha\in PS$ and since $\alpha\beta\in PS$, we also have $\alpha\beta r\in PS$. Hence $\alpha\in PS$.

(b) In view of the Lemma in the proof of Theorem 22(b) (p. 48), we take $A=P,B=(\beta,\beta_1,\ldots,\beta_n)$, then $\exists\gamma\in K$ s.t. $\gamma B\subset R$ and $\gamma B \not\subset A=P$. So we have $\gamma\beta\notin P$ or $\gamma\beta_i\notin P$ for some $i$. Note that in both cases we always have $\gamma\beta,\gamma\beta_i \in R$ for all $i$.

If the latter case occurs then we are done, so suppose $\gamma\beta_i\in P$ $\forall i$, then we must have $\gamma\beta\in R\setminus P$. Since $\alpha\notin PS$, by (a) we have $\alpha\beta\gamma=\alpha_1\beta_1\gamma+\cdots+\alpha_n\beta_n\gamma\notin PS$, which is absurd.

(c) (The idea of the proof is very similar to the proof of Theorem 24 (p. 50).) Suppose $e(Q/P)>1$ where $Q$ is a prime in $S$ lying over $P$. Write $PS=QJ\sbne J$ where $J$ is divisible by all primes of $S$ lying over $P$. Take $\alpha\in J\setminus PS$, then $\alpha$ is in every prime of $S$ lying over $P$, but not in $PS$.

Write $\alpha=\alpha_1\beta_1+\cdots+\alpha_n\beta_n$ where $\beta_n\in K$. By Exercise 2.25, $\exists m\in\ZZ$ s.t. $m\beta_i\in R$ $\forall i$. Then $\alpha m=\alpha_1\beta_1m+\cdots+\alpha_n\beta_nm$. Since $\alpha\notin PS$. By (b), $\exists\gamma\in K$ s.t. $\gamma m\in R$, $\gamma\beta_im\in R$ for all $i$ and $\gamma\beta_i m\notin P$ for some $i$. WLOG, may assume $\gamma\beta_1m\notin P$.

Let $\sigma_1,\ldots,\sigma_n$ be the embeddings of $L$ in $\CC$ which fix $K$. Extend them to automorphisms of some extension $M$ of $L$ which is normal over $K$. Set $d=\disc^L_K(\alpha_1,\ldots,\alpha_n)$, then similar to Exercise 3.18, we have $\disc^L_K(\alpha m\gamma,\alpha_2,\ldots,\alpha_n)=(\gamma\beta_1 m)^2d$. Since $(\gamma\beta_1m)^2\notin P$, it's remaining to show $\disc^L_K(\alpha m\gamma,\alpha_2,\ldots,\alpha_n)\in P$ (using the property of prime ideal). 

Let $I$ be any prime in $T$, the number ring of $M$, lying over $P$. Note that $P\subset I\cap S$, so $I\cap S$ is a prime of $S$ lying over $P$. And since $\alpha$ is in every prime of $S$ lying over $P$. We have $\alpha\in I\cap S\subset I$. This means $\alpha$ is in every prime of $T$ lying over $P$. Moreover, for each $\sigma_i$, since $\sigma_i^{-1}(I)$ is still a prime in $T$ lying over $P$, we have $\alpha\in \sigma_i^{-1}(I)$. So $\sigma_i(\alpha)\in I$. And since $\gamma m\in R$, we have $\gamma m\sigma_i(\alpha)=\sigma_i(\gamma m\alpha)\in I$. This shows that $\disc^L_K(\alpha m\gamma,\alpha_2,\ldots,\alpha_n)\in I$. This number is automatically in $R$ because it's the discriminant of the elements in $S$. Hence, $\disc^L_K(\alpha m\gamma,\alpha_2,\ldots,\alpha_n)\in I\cap R=P$, as desired.

\subsection*{Exercise 3.20}

Let $B_i:=\{\beta^{(i)}_1,\ldots,\beta^{(i)}_{f_i}\}$ and consider 
$$
\sum_{i,j,k} c_{ijk}\alpha_{ij}\beta^{(i)}_k=s\in PS
$$ 
where $c_{ijk}\in R$ and the sum is taken over all $1\leq i\leq r,1\leq j\leq e_i,1\leq k\leq f_i$. Now fix an index $i$. We want to show all $c_{ijk}\in P$, so when we mod $P$, the corresponding elements of $\alpha_{ij}\beta^{(i)}_k$ are linearly independent over $R/P$.

Consider the equation mod $Q_i$. Since among all $\alpha_{ij}$, only $\alpha_{i1}\notin Q_i$. So we get 
$$
c_{i11}\alpha_{i1}\beta^{(i)}_1+\cdots+c_{i1f_i}\alpha_{i1}\beta^{(i)}_{f_i}\equiv0\pmod{Q_i}.
$$ 
Note that since the corresponding quotient ring is a field, so we can cancel out $\alpha_{i1}$. Moreover, since $\{\beta^{(i)}_1,\ldots,\beta^{(i)}_{f_i}\}$ corresponds a basis for $S/Q_i$ over $R/P$, we have $c_{i11}=\cdots=c_{i1f_i}\in P$.

Now consider the equation mod $Q^2_i$. Since among all $\alpha_{ij}$, only $\alpha_{i1},\alpha_{i2}\notin Q^2_i$. So we get 
$$
c_{i11}\alpha_{i1}\beta^{(i)}_1+c_{i21}\alpha_{i2}\beta^{(i)}_1+\cdots+c_{i1f_i}\alpha_{i1}\beta^{(i)}_{f_i}+c_{i2f_i}\alpha_{i2}\beta^{(i)}_{f_i}\equiv0\pmod{Q^2_i}.
$$ 
First note that since $c_{i11}=\cdots=c_{i1f_i}\in P$, we have $c_{i11}\alpha_{i1},\ldots,c_{i1f_i}\alpha_{i1}\in PS\subset Q^2_i$, so the corresponding terms disappear. Also, we know $Q_i^2\subset Q_i$. These give us 
$$
c_{i21}\alpha_{i2}\beta^{(i)}_1+\cdots+c_{i2f_i}\alpha_{i2}\beta^{(i)}_{f_i}\equiv0\pmod{Q_i}.
$$ 
And using the same argument in the first step, we have $c_{i21}=\cdots=c_{i2f_i}\in P$.

Since the same holds for each $i$, and by repeating this process, we now know all $c_{ijk}\in P$, this completes the proof. 

\subsection*{Exercise 3.21 \color{red}(incomplete, missing (b))}

(a) We first claim that $\alpha_1,\ldots,\alpha_n$ are linearly independent over $\ZZ$. (This would imply $G$ is free with rank $n$.) Consider $c_1\alpha_1+\cdots+c_n\alpha_n=0$ where $c_i\in\ZZ$. Since $\alpha_1,\ldots,\alpha_n$ are independent mod $p$, we have $c_i\in p\ZZ$ for all $i$. We then dividing both sides by $p$, the coefficients are still integers and thus still in $p\ZZ$. Repeat the same argument we have $p^k\mid c_i$ $\forall k\in\NN$. This forces all $c_i$ to be 0.

Write $G=\ZZ\alpha_1\oplus\cdots\oplus\ZZ\alpha_n$. By Exercise 2.27 (a), $\#(S/G)<\infty$. If $p\mid \#(S/G)$, then by Cauchy's theorem, $\exists s+G\in S/G$ with order $p$. Then $ps+G=0+G$ in $S/G$, i.e., $ps\in G$. Write $ps=m_1\alpha_1+\cdots+m_n\alpha_n$ where $m_i\in\ZZ$. Since $\alpha_1,\ldots,\alpha_n$ are independent mod $p$ and $ps\in pS$, we have $m_i\in p\ZZ$ for all $i$. By dividing both sides by $p$ we get $s=m_1'\alpha_1+\cdots+m_n'\alpha_n$ where $m'_i\in\ZZ$. So $s\in G$ and thus $s+G$ is the identity element in $S/G$, which is absurd.

By Exercise 2.27 (c), $\disc(\alpha_1,\ldots,\alpha_n)=\disc(G)=\#(S/G)^2\disc(S)$. And from $p\nmid \#(S/G)$ we have $p\nmid \#(S/G)^2=m$.

\subsection*{Exercise 3.22}

\subsection*{Exercise 3.23}

(3.2) Suppose $m\equiv 3\pmod{4}$. This means $R=\ZZ[\sqrt{m}]$. We want to show $2R=(2,1+\sqrt{m})^2=(4,2+2\sqrt{m},m+1+2\sqrt{m})$. $\spe$ is clear. (Note that $m+1$ is even.) On the other hand,
since $(m+1+2\sqrt{m})-(2+2\sqrt{m})=m-1\in\rhs$, so is $\gcd(4,m-1)=2$. So we get $\sbe$.

(3.3) Suppose $m\equiv 1\pmod{8}$. This implies $m\equiv 1\pmod{4}$ and so $R=\ZZ[{(1+\sqrt{m})/2}]$. We want to show $2R=(2,(1+\sqrt{m})/2)(2,(1-\sqrt{m})/2)=(4,1-\sqrt{m},1+\sqrt{m},(1-m)/4)$. $\spe$ is clear. (Note that $(1-m)/4$ is even.) On the other hand, from $(1-\sqrt{m})+(1+\sqrt{m})=2\in\rhs$, we get $\sbe$.

Since $2\nmid m=\disc(R)$. By Theorem 24 (p. 50), $2$ is unramified in $R$. So the two factors are distinct.

(3.5) Suppose $p\nmid m$ is odd and $m\equiv n^2\pmod{p}$. We want to show $pR=(p,n+\sqrt{m})(p,n-\sqrt{m})=(p^2,pn-p\sqrt{m},pn+p\sqrt{m},n^2-m)$. $\spe$ is clear. (Note that $p\mid n^2-m$.) On the other hand, from $(pn-p\sqrt{m})+(pn+p\sqrt{m})=2pn\in\rhs$, so is $\gcd(p^2,2pn)=p$. (Here we've used the the facts that $p$ is odd, and since $p\nmid m,p\mid n^2-m$, we must have $p\nmid n$.) So we get $\sbe$.

Since $p\nmid m$ is odd, we know $p\nmid\disc(R)=m,4m$. By Theorem 24 again, $p$ is unramified in $R$. So the two factors are distinct.

(3.4) Suppose $m\equiv 5\pmod{8}$. This implies $m\equiv 1\pmod{4}$ and so $R=\ZZ[{(1+\sqrt{m})/2}]$. Consider the polynomial 
$$
f(x)=x^2-x+\frac{1-m}{4}\in\ZZ[x].
$$ 
Since $f((1+\sqrt{m})/2)=0$, $f$ has a root in $R$, and so a root in $R/P$. On the other hand, $\ovl{f}(x)=x^2+x+1\in\ZZ/2\ZZ[x]$ has no root in $\ZZ/2\ZZ$. So $R/P\not\simeq\ZZ/2\ZZ$.

\subsection*{Exercise 3.24 \color{red}(incomplete, missing (c))}

(a) Let $M$ be any intermediate field of $K$ and $L$ with the corresponding number ring $T$. Let $I:=Q\cap T$ be the unique prime ideal in $T$ lying under $Q$. Since $I\cap R=Q\cap T\cap R=Q\cap R=P$, so $I$ lies over $P$. Moreover, if $I'$ is another prime in $T$ lying over $P$, then from $Q^n=PS\subset I'S$ we have $I'S\mid Q^n$. This means $I'S$ is a power of $Q$. In particular, $Q$ lies over $I'$ and so $I=I'$. This shows that $I$ is the unique prime in $T$ lying over $P$. So $PT$ is a power of $I$. And from $1=f(Q/P)=f(Q/I)f(I/P)$ we get $f(I/P)=1$. Hence, $PT=I^{[M:K]}$.

(b) Set $M:=L\cap L'$ with the corresponding number ring $T$. Clearly $K\subset M$. We consider the following diagram of field extensions
\begin{center}
    \begin{tikzpicture}
    \draw (0,-0.5) node (K) {$R\subset K$};
    \draw (-2,2) node (A) {$S\subset L$};
    \draw (2,2) node (B) {$L'\supset S'$};
    \draw (0,1) node (M) {$M$};
    \draw (M) -- (A) -- (K) --node {$m$}  (M) -- (B) -- (K);
    \end{tikzpicture}
\end{center}
It's sufficient to show $m:=[M:K]=1$. Since $P$ is totally ramified in $L$, by (a), $P$ is totally ramified in $M$. So $PT=I^m$ for some prime $I$ in $T$. This means $e(I/P)=m$.

On the other hand, since $P$ is unramified in $L'$, we may write $PS'=Q'_1\cdots Q'_r$ where $Q'_i$ are distinct. ($S':=\AA\cap L'$.) Observe that $I^mS'=PTS'=PS'=Q'_1\cdots Q'_r$, so we have $Q'_i \mid I^m S' = (IS')^m$ and so $Q'_i \mid IS'$. This means $Q'_i$ lies over $I$ for all $i=1,\ldots,r$. And from $1=e(Q'_i/P)=e(Q'_i/I)e(I/P)=e(Q'_i/I)\cdot m$, we have $m=1$.

%(c) First we consider the case $m=p^r,\omega=e^{2\pi i/m}$. Since $(p)=p\ZZ[\omega]=(1-\omega)^{\phi(m)}$, by Theorem 22 (a) (p. 46), we have $\|(1-\omega)\|^{\phi(m)}=\|(1-\omega)^{\phi(m)}\|=\|p\ZZ[\omega]\|=p^{[\QQ(\omega):\QQ]}$. Let $f:=f((1-\omega)/p)$, then $\|(1-\omega)\|=p^f$. So $\|(1-\omega)\|^{\phi(m)}=p^{f\phi(m)}=p^{[\QQ(\omega):\QQ]}$. This tells us $[\QQ(\omega):\QQ]\geq\phi(m)$. On the other hand, by the simple observation on p. 12 saying that the only candidates for the conjugates of $\omega$ are the $\omega^k$ where $1\leq k\leq m,\gcd(k,m)=1$. This means $[\QQ(\omega):\QQ]\leq\phi(m)$. Hence, we have $[\QQ(\omega):\QQ]=\phi(m)$. (Note that all the facts we've used didn't assume that $[\QQ(\omega):\QQ]=\phi(m)$.)

\subsection*{Exercise 3.25}

(a) Write $f(x)=\sum_{i=0}^n a_ix^i,g(x)=\sum_{i=0}^m b_ix^i$. WLOG, assume $n\geq m$. Then $\ovl{f}=\ovl{g}$ iff $a_i\equiv b_i\pmod{I}$ for $i=1,\ldots,m$ and $a_i\equiv 0\pmod{I}$ for $i=m+1,\ldots,n$ iff $a_i-b_i\in I$ for $i=1,\ldots,m$ and $a_i\in I$ for $i=m+1,\ldots,n$ iff $f-g\in I[x]$.

(b) $\ovl{g}\mid\ovl{f} \iff \ovl{f}=\ovl{g}\cdot\ovl{h}$ for some $\ovl{h}\in (R/I)[x] \iff f-gh\in I[x]$ for some $h\in R[x] \iff f\in(I,g)$. (We've used (a) in the second if and only if.)

(c) Consider the canonical ring homomorphism $\phi:R[x]\to(R/I)[x]/(\ovl{g})$ where $\phi(f):=\ovl{f}+(\ovl{g})$. This is clearly surjective. Moreover, $f\in\ker\phi \iff \ovl{f}+(\ovl{g})=0$ in $(R/I)[x]/(\ovl{g}) \iff \ovl{f}\in(\ovl{g}) \iff \ovl{g}\mid\ovl{f} \iff f\in(I,g)$. (We've used (b) in the last if and only if.) So $\ker\phi=(I,g)$ and hence $R[x]/(I,g)\simeq (R/I)[x]/(\ovl{g})$.

\subsection*{Exercise 3.26}

Write $m=hk^2$ where $h,k$ are relatively prime and square-free.

(a) We've found an integral basis of $R$ in Exercise 2.41 (or just see the application of Theorem 13 (p. 28)). Using this together with Theorem 6 (p. 18), it's easy to find that
$$
\disc(R) =
\begin{cases}
-27m^2/k^2, & m\not\equiv \pm1 \pmod{9}. \\
-3m^2/k^2, & m\equiv \pm1 \pmod{9}.
\end{cases}
$$
And from Exercise 2.41(a) we know $\disc(\ZZ[\alpha])=-27m^2$. So using the formula in Exercise 2.27(c), we obtain
$$
\#(R/\ZZ[\alpha]) =
\begin{cases}
k, & m\not\equiv \pm1 \pmod{9}. \\
3k, & m\equiv \pm1 \pmod{9}.
\end{cases}
$$

Now, suppose $p\neq 3$ is a prime and $p^2\nmid m=hk^2$. Then we have $p\nmid k$ and so $p\nmid \#(R/\ZZ[\alpha])$. Hence by Theorem 27 (p. 55) we can decompose $pR$ by factoring $\Irr_\QQ(\alpha)=x^3-m$ in $(\ZZ/p\ZZ)[x]$.

(b) First, we note that $\QQ(\alpha) = \QQ(\gamma)$ (so we are changing the generator from $\alpha$ to $\gamma$ in Theorem 27). Using Theorem 6 (p. 18) again, we can easily find that $\disc(\ZZ[\gamma])=\disc(1,\alpha^2/k,m\alpha/k^2)=-27m^4/k^6$. So using the formula in Exercise 2.27(c) again, we obtain 
$$
\#(R/\ZZ[\gamma]) =
\begin{cases}
h, & m\not\equiv \pm1 \pmod{9}. \\
3h, & m\equiv \pm1 \pmod{9}.
\end{cases}
$$

Now, suppose $p^2\mid m=hk^2$. Then we have $p\mid k$ and $p\nmid h$. So when $p\neq 3$ we have $p\nmid \#(R/\ZZ[\gamma])$. And for $p=3$ we have $m\equiv 0\not\equiv \pm 1\pmod{9}$. So $p=3\nmid h = \#(R/\ZZ[\gamma])$. Hence in either case we can (by Theorem 27) decompose $pR$ by factoring $\Irr_\QQ(\alpha)=x^3-m$ in $(\ZZ/p\ZZ)[x]$ as the followings:

Let $g(x):=\Irr_\QQ(\gamma)=\Irr_\QQ(\alpha^2/k)=x^3-h^2k$. From $p\mid k$ we have $\ovl{g}=x^3\in(\ZZ/p\ZZ)[x]$. So by Theorem 27, $pR=(p,\gamma)^3=(p,\alpha^2/k)^3$.

(c) Suppose $m\not\equiv \pm1\pmod{9}$ and consider $p=3$. If $3 \mid k \implies 3^2 \mid m$. So from (b) we know $3R=(3,\alpha^2/k)^3$. On the other hand, if $3\nmid k = \#(R/\ZZ[\alpha])$, then we can apply Theorem 27 by factoring $g=\Irr_\QQ(\alpha)=x^3-m$ in $(\ZZ/3\ZZ)[x]$.

Case 1: If $3\nmid m$, then this splits to two subcases, $m\equiv 1,2\pmod{3}$. For the first subcase, $\ovl{g}=x^3+2=(x+2)^3\in(\ZZ/3\ZZ)[x]$. So $3R=(3,\alpha+2)^3$. For the second subcase, $\ovl{g}=x^3+1=(x+1)^3\in(\ZZ/3\ZZ)[x]$. So $3R=(3,\alpha+1)^3$.

Case 2: If $3\mid m$, then $\ovl{g}=x^3\in(\ZZ/3\ZZ)[x]$. So $3R=(3,\alpha)^3$.

In conclusion, if $m\not\equiv \pm1\pmod{9}$, then $3$ is totally ramified in $R$.

(d) Let's first do the general case for $m\equiv 1 \pmod{9}$. Set $\beta=(\alpha-1)^2/3$. The following calculations are all due to Exercise 3.18.
\begin{align*}
    &\disc(\beta) = \disc(\ZZ[\beta]) = \disc(1,\beta,\beta^2) = \disc\left(1,\frac{(\alpha-1)^2}{3},\frac{(\alpha-1)^4}{3^2}\right) \\ ={} &\frac{1}{3^6}\disc(1,\alpha^2-2\alpha+1,\alpha^4-4\alpha^3+6\alpha^2-4\alpha+1) \\ ={} &\frac{1}{3^6}\disc(1,\alpha^2-2\alpha+1,6\alpha^2+(m-4)\alpha+(1-4m)) \\ ={} &\frac{1}{3^6}\disc(1,\alpha^2-2\alpha+1,6\alpha^2+(m-4)\alpha+(1-4m)-6(\alpha^2-2\alpha+1)+(5+4m)) \\ ={} &\frac{1}{3^6}\disc(1,\alpha^2-2\alpha+1,(m+8)\alpha) = \frac{(m+8)^2}{3^6}\disc(1,\alpha,\alpha^2-2\alpha+1) \\ ={} &\frac{(m+8)^2}{3^6}\disc(1,\alpha,\alpha^2-2\alpha+1+(2+k^2)\alpha+(k^2-1)) \\ ={} &\frac{(m+8)^2}{3^6}\disc\left(1,\alpha,\alpha^2+k^2\alpha+k^2\right) = \frac{k^2(m+8)^2}{3^4}\disc\left(1,\alpha,\frac{\alpha^2+k^2\alpha+k^2}{3k}\right) \\ ={} &\frac{k^2(m+8)^2}{3^4}\disc(R) = \#(R/\ZZ[\beta])^2\disc(R).
\end{align*}
The last equality is by Exercise 2.27(c). So we have $\#(R/\ZZ[\beta])=\pm k(m+8)/9\in\NN$.

To use Theorem 27, we hope $3\nmid \pm k(m+8)/9$, or equivalently, $27\nmid \pm k(m+8)$. From $m\equiv 1 \pmod{9}$ we have $m\equiv 1,10,19 \pmod{27} \implies m+8\equiv 9,18,0 \pmod{27}$. So if the first two cases happen, then our hope is fulfilled. (Note that we have $3\nmid k$ because $m\equiv 1 \pmod{9}$.) But if the third case happens, i.e., $m\equiv 19\equiv -8 \pmod{27}$, then we wouldn't be able to use Theorem 27.

Now let's consider $m=10\equiv 1\pmod{9}$. Note that we can use Theorem 27 in this case by the above observation. By Exercise 2.41(d), $g=\Irr_\QQ(\beta)=\Irr_\QQ((\alpha-1)^2/3)=x^3-x^2+7x-3$. So $\ovl{g}=x^3+2x^2+x=x(x+1)^2\in(\ZZ/3\ZZ)[x]$. Hence, $3R=(3,\beta)(3,\beta+1)^2$.

For the case where $m\equiv -1\pmod{9}$, set $\beta=(\alpha+1)^2/3$ and use a similar argument.

(e) When $m\equiv \pm1\pmod{9}$, we know from (a) that $\disc(R) = -3m^2/k^2 = -3h^2k^2$. As $3\nmid m$, we have $9 \nmid \disc(R)$.

Suppose $3R = P^3$ is a cube of a prime. By Exercise 3.20 there exist $\alpha_1,\alpha_2,\alpha_3 \in R$ which are independent mod $3$. And by Exercise 3.21(a), we have $\disc(\alpha_1,\alpha_2,\alpha_3) = c\cdot\disc(R)$ with $3\nmid c$. This implies that $9 \nmid \disc(\alpha_1,\alpha_2,\alpha_3)$. But by Exercise 3.21(b), we have $\disc(\alpha_1,\alpha_2,\alpha_3)$ is divisible by $3^{3-1} = 9$, which is absurd.

Since $3 \mid \disc(R) = -3h^2k^2$, so by the converse of Theroem 24 (p. 50), $3$ is ramified in $R$. Hence $3R = P^2Q$ where $P,Q$ are distinct primes in $R$.

\subsection*{Exercise 3.27}

\subsection*{Exercise 3.28}

\subsection*{Exercise 3.29}

(a) Since $f$ has a root $r$ in $\ZZ/p\ZZ$, $\ovl{f}$ has an irreducible factor $x-r$ in $(\ZZ/p\ZZ)[x]$ with multiplicity (say) $e$. Moreover, since $p\nmid \#(R/\ZZ[\alpha])$, by Theorem 27 (p. 55), $pR$ has a prime divisor $P:=(p,\alpha-r)$ with $e(P/p)=e$ and $f(P/p)=\deg(x-r)=1$. This means $R/P\simeq \ZZ/p\ZZ$.

Let $\phi:R/P\isoto\ZZ/p\ZZ$ where $\phi(1+P)=[1]_p\in\ZZ/p\ZZ$ and $\psi:R\to R/P$ be the quotient map. Define $\Phi=\phi\circ\psi:R\to R/P\isoto\ZZ/p\ZZ$, then $\Phi$ is a ring homomorphism. Moreover, since $\alpha-r\in P$, we have $\alpha+P=r+P$. So $\Phi(\alpha)=\phi(\alpha+P)=\phi(r+P)=[r]_p\in\ZZ/p\ZZ$.

(b) By Exercise 2.28 (d) we have $\ZZ[\alpha]=R$. So we can apply Theorem 27 (p. 55) for any $p$. Let $f:=\Irr_\QQ(\alpha)=x^3-x-1$. We take $p=5$, then $\ovl{f}$ has a root $2$ in $\ZZ/5\ZZ$. By (a), there exists a ring homomorphism $\Phi:R\to\ZZ/5\ZZ$ s.t. $\Phi(\alpha)=[2]_5$.

Now, if $\sqrt{\alpha}\in\QQ(\alpha)$, then since $\sqrt{\alpha}$ satisfies $x^6-x^2-1$, we have $\sqrt{\alpha}\in R$. But this is a contradiction as $\Phi(\sqrt{\alpha})^2=\Phi(\sqrt{\alpha}^2)=\Phi(\alpha)=2$ and $2$ is not a sqaure in $\ZZ/5\ZZ$.

(c) Take $p=7$, then $\ovl{f}$ has a root $5$ in $\ZZ/7\ZZ$. By (a), there exists a ring homomorphism $\Phi:R\to\ZZ/7\ZZ$ s.t. $\Phi(\alpha)=[5]_7$. Now, if $\sqrt[3]{\alpha}\in\QQ(\alpha)$, then since $\sqrt[3]{\alpha}$ satisfies $x^9-x^3-1$, we have $\sqrt[3]{\alpha}\in R$. But this is a contradiction as $\Phi(\sqrt[3]{\alpha})^3=\Phi(\alpha)=5$ and $5$ is not a cube in $\ZZ/7\ZZ$.

Similarly, if $\sqrt{\alpha-2}\in\QQ(\alpha)$, then since $\sqrt{\alpha-2}$ satisfies $(x^2+2)^3-(x^2+2)-1$, we have $\sqrt{\alpha-2}\in R$. But this is again a contradiction as $\Phi(\sqrt{\alpha-2})^2+2=\Phi(\sqrt{\alpha-2}^2+2)=\Phi(\alpha)=5$ and $5-2=3$ is not a square in $\ZZ/7\ZZ$.

(d) Suppose $(x,y,z)\in R^3$ is a solution to the equation $x^4+y^4+z^4=\alpha$. Since $f(x)=\Irr_\QQ(\alpha)=x^5+2x-2$. By Exercise 2.43 (a) and Exercise 2.27 (c), we have $\disc(\alpha)=\disc(\ZZ[\alpha])=4^42^5+5^5(-2)^4=2^4\cdot 3637=\#(R/\ZZ[\alpha])^2\disc(R)$. ($3637$ is a prime number.)

Take $p=5\nmid \#(R/\ZZ[\alpha])$. Then $\ovl{f}$ has a root $4$ in $\ZZ/5\ZZ$. By (a), there exists a ring homomorphism $\Phi:R\to\ZZ/5\ZZ$ s.t. $\Phi(\alpha)=[4]_5$. So $\Phi(\alpha)=\Phi(x^4+y^4+z^4)=\Phi(x)^4+\Phi(y)^4+\Phi(z)^4\equiv 4\pmod{5}$. But this is a contradiction because $a^4\equiv 0,1 \pmod{5}$, so there's no solution to the congruence equation $a^4+b^4+c^4\equiv 4\pmod{5}$.

\subsection*{Exercise 3.30 \color{red}(incomplete, missing (e))}

(a) Let $f(x)\in\ZZ[x]$ be given where $\deg f\geq1$. First, assume $f(0)=1$. We claim that the set
$$
\Pcal=\{ p \mid p \text{ divides } f(n!) \text{ for some } n\in\NN\}
$$
consists of infinitely many primes. (Then we will have infinite number of primes with the desired property.)

If not, write $\Pcal=\{p_1,\ldots,p_r\}$. WLOG, assume $p_1<p_2<\cdots<p_r$. We consider $f(p_r!)$ and note that the set of prime divisors of $f(p_r!)$ is a non-empty subset of $\Pcal$. Take $p_i\in\Pcal$ s.t. $p_i\mid f(p_r!)$. Moreover, observe that $p_i\mid f(p_r!)-1$ as $p_i \mid p_r!$ and $f(0)=1$. So we have $p_i\mid 1$, a contradiction.

For general $f$, set $g(x):=f(xf(0))/f(0)\in\ZZ[x]$. (Note that we may assume $f(0)\neq0$.) Then $g(0)=1$. By the previous proof, there exist infinitely many primes s.t. $g(x)$ has a root (say $x_p$) mod $p$. Set $x'_p=x_pf(0)$ for each $p$, then $f(x'_p)=f(x_pf(0))=f(0)g(x_p)\equiv 0\pmod{p}$. So $x'_p$ is a solution to $f(x)$ mod $p$.

(b) Let $K=\QQ(\alpha),R:=\AA\cap K$ and $f:=\Irr_\QQ(\alpha)$. By (a), there're infinitely many primes $p$ s.t. $\ovl{f}$ has a root in $\ZZ/p\ZZ$. Define
$$
\pfk := \{p \mid \ovl{f} \text{ has a root in } \ZZ/p\ZZ \text{ and } p \nmid \#(R/\ZZ[\alpha]) \}
$$
which is still an infinite set. Then for each $p\in\pfk$, since $\ovl{f}$ has a linear factor in $(\ZZ/p\ZZ)[x]$, by Theorem 27 (p. 55), there's a prime ideal $P_p$ in $R$ lying over $p$ with $f(P_p/p)=1$. Let $\Pfk:=\{P_p \mid p\in\pfk\}$. Note that this is still an infinite set as there's a natural one-to-one map from $\pfk$ to $\Pfk$ (different $p\in\pfk$ correspond to different $P_p\in\Pfk$). So we are done.

(c) Fix $m\in\NN$. Consider $K=\QQ(\omega)$ where $\omega:=e^{2\pi i/m}$. By (b), there're infinitely many primes $P$ in $K$ s.t. $f(P/p)=1$ where $p$ is the unique prime in $\ZZ$ lying under $P$. Define
$$
\pfk := \{p \mid f(P/p) = 1 \text{ and } p \nmid m \}
$$
which is still an infinite set. (If not, then there would be only finitely many primes in $K$ lying above them.) Then for each $p\in\pfk$, by Theorem 26 (p. 53), we have $f=1$ is the order of $p$ in $(\ZZ/m\ZZ)^\times$, i.e., $p\equiv1\pmod{m}$.

(d) Let $M$ be the normal closure of $L$ over $K$ with the number ring $T$. Consider the tower of field extensions $\QQ \subset K \subset L \subset M$. By (b), there're infinitely many primes $U$ in $M$ s.t. $f(U/p)=1$ where $p$ is the unique prime in $\ZZ$ lying under $U$. Define
$$
\pfk := \{p \mid f(U/p) = 1 \text{ and } p \nmid \disc(T) \}
$$
which is still an infinite set. (Again, if not, then there would be only finitely many primes in $M$ lying above them.) Note that by Theorem 24 (p. 50), we have $e(U/p)=1$ for all $p\in \pfk$.

Now, define
$$
\Pfk := \{P \subset K \mid P \supset p \text{ for some } p\in\pfk \}
$$
which is still an infinite set as $\pfk$ is. For any $P\in\Pfk$, let $Q$ be any prime in $L$ lying over $P$. Then we have $f(Q/P)=e(Q/P)=1$ as $M/K$ is normal and $f(U/p)=e(U/p)=1$. (See Exercise 3.10 if necessary.) This shows that every $P\in\Pfk$ splits completely in $L$.

\subsection*{Exercise 3.31}

(a) Let $\alpha I,\beta J$ be two fractional ideals of $K$ and suppose $\alpha I=\alpha'I'$ and $\beta J=\beta'J'$. We want to show $(\alpha I)(\beta J)=(\alpha'I')(\beta'J')$, i.e., $\alpha\beta IJ=\alpha'\beta'I'J'$. Let $\alpha\beta\sum r_is_i\in\alpha\beta IJ$ where $r_i\in I,s_i\in J$. Then each $\alpha r_i=\alpha'r_i'$ for some $r_i'\in I'$ and $\beta s_i=\beta's_i'$ for some $s_i'\in J'$. So $\alpha\beta \sum r_is_i=\sum (\alpha r_i)(\beta s_j) = \sum (\alpha'r_i')(\beta's_j') = \alpha'\beta' \sum r_i's_i' \in \alpha'\beta' I'J'$. This shows that $\alpha\beta IJ\sbe \alpha'\beta'I'J'$. A similar argument can show the other containment. Hence, this operation is well-defined.

(b) Let $I=\alpha A$ be a fractional ideal in $K$. By Theorem 15 (p. 40), there exists an ideal $B$ in $R$ s.t. $AB=(r)$ is principal. Using the given definition of $I^{-1}$, it's easy to check that in fact $I^{-1}=(\alpha r)^{-1}B$. So $I^{-1}$ is also a fractional ideal in $K$. Moreover, $II^{-1}=(\alpha A)((\alpha r)^{-1}B)=r^{-1}\cdot(r)=R$.

Note that $R=1\cdot R$ is a fractional ideal, and $IR=(\alpha A)(1R)=\alpha A=I$ for any fractional ideal $I$. So the fractional ideals in $K$ form a group under multiplication (which is well-defined by (a)), with the identity element $R$.

(c) Let $I$ be a fractional ideal and write $I=b/a\cdot A$, where $a,b\in R$ and $A$ is an ideal in $R$. Then $(a)I=(b)A$. By Theorem 16 (p. 42), we may write uniquely that $(a)=\pfk_1\cdots\pfk_t$ and $(b)A=\qfk_1\cdots\qfk_s$ where $\pfk_i,\qfk_j$ are primes in $R$. From (b) we know $(\pfk_1\cdots\pfk_t)(\pfk_1\cdots\pfk_t)^{-1}=R$. So $I=\qfk_1\cdots\qfk_s(\pfk_1\cdots\pfk_t)^{-1}$. By canceling the common terms, we may write $I=P_1^{m_1}\cdots P_r^{m_r}$ where $P_k$ are distinct primes in $R$ and $m_i\in\ZZ$. The uniqueness follows immediately.

Let $G$ be the group of all fractional ideals and $H:=\{\alpha R\mid \alpha\in K^\times\}$ be its subgroup consisting of all principal fractional ideals. Now, given $b_1/a_1R, b_2/a_2R\in H$. Observe that $b_1/a_1R=b_2/a_2R \iff (a_2b_1)=(a_1b_2) \iff a_2b_1=a_1b_2\cdot u$ where $u\in R$ is a unit (or equivalently, $a_2b_1\cdot u^{-1}=a_1b_2$) $\iff b_1/a_1=b_2/a_2\cdot u$ (or equivalently, $b_1/a_1\cdot u^{-1}=b_2/a_2$). This gives us a motivation to define $U:=\{v/u\in K^\times\mid u,v\in R\text{ are units}\}$. It's easy to see that $U$ is a subgroup of $K^\times$. We claim that $H\simeq K^\times/U$.

Define $\phi:H\to K^\times/U$ where $\phi(\alpha R):=\alpha U$. Note that if $\alpha R=\beta R$, then by the above observation, $\alpha=\beta u$ for some unit $u\in R$. This means $\phi(\alpha R)=\alpha U=\beta U=\phi(\beta R)$. So $\phi$ is well-defined. Moreover, $\phi(\alpha R\cdot \beta R)=\phi(\alpha\beta R)=\alpha\beta U=\alpha U\cdot \beta U=\phi(\alpha R)\phi(\beta R)$, so $\phi$ is a group homomorphism.

If $\phi(\alpha R)=\alpha U=1U$, then $\alpha=1\cdot v/u=v/u$ where $u,v\in R$ are units. Since $vR=uR$, we have $\alpha R=v/u R = R$ is the identity element in $H$, so $\phi$ is injective. The surjectivity is obvious. So indeed $H\simeq K^\times/U$.

(d) $(\Rightarrow)$ By Theorem 16 (p. 42), it's sufficient to show that every prime ideal $P$ in $R$ is principal. Let $S:=\{(r)=rR\mid 0\neq r\in R\}$. By assumption, $\phi:S\isoto \oplus_i \ZZ_{\geq0} \cdot P_i$ where the direct sum is indexed by all prime ideals, and if $(r)=\prod_i P_i^{n_i}$, $\phi((r)):=\sum_i n_iP_i$ (a formal sum). Since $P=1\cdot P\in \oplus_{i} \ZZ_{\geq0} \cdot P_i$. So $\phi^{-1}(1\cdot P)=P^1=P\in S$, i.e., $P$ is principal.

$(\Leftarrow)$ Suppose $R$ is a PID. Consider the free abelian semigroup $\oplus_{i} \ZZ_{\geq0}\cdot P_i$ generated by all prime ideals in $R$. Define $\psi:\oplus_{i} \ZZ_{\geq0}\cdot P_i \to S$ by $\psi(\sum_i n_iP_i)=\prod_i P_i^{n_i}$. This is well-defined because all prime ideals are now principal ideals. And it's clearly a bijective group homomorphism. So the result follows.

(e) We first note that $G$ is an abelian group because $R$ is a Dedekind domain. So $H$ is automatically normal in $G$. Let $G(R)$ be the ideal class group of $R$. Define $\phi:G(R)\to G/H$ by $\phi([I])=IH$. (We denote $[\cdot],\cdot H$ the elements in $G(R),G/H$, respectively.)

If $[I]=[J]$, then $\exists a,b\in R$ s.t. $aI=bJ$, so $I=b/a\cdot J = (b/aR)J$. Since $b/aR\in H$, we have $\phi([I])=\phi([J])$. So $\phi$ is well-defined. Moreover, given $[I],[J]\in G(R)$, $\phi([I][J])=\phi([IJ])=(IJ)H=IH\cdot JH=\phi([I])\phi([J])$. So $\phi$ is a group homomorphism.

Suppose $I,J$ are two ideals in $R$ s.t. $\phi([I])=\phi([J])$, i.e., $IH=JH$. Then there exists $\alpha=b/a\in K^\times$ where $a,b\in R$ s.t. $I=\alpha R\cdot J = b/a J$, or equivalently, $aI=bJ$. This means $[I]=[J]$ and so $\phi$ is injective. Moreover, given $(\alpha I)H\in G/H$. Then $\phi([I])=IH=(\alpha I)H$ because $I=(\alpha I)(\alpha^{-1}R)$ and $\alpha^{-1}R\in H$. This means $\phi$ is surjective. Hence, we have $G(R)\simeq G/H$.

(f) Given a fractional ideal $\alpha I$ of $K$. It's clearly an $R$-submodule because $I$ is an ideal in $R$. Moreover, as $R$ is a Dedekind domain, by the definition (p. 39), $I$ is finitely generated. Write $I=r_1R+\cdots+r_nR$ where $r_i\in I$. Then $\alpha I=\alpha(r_1R+\cdots+r_nR)=\alpha r_1R+\cdots+\alpha r_nR$ where $\alpha r_i\in\alpha I$. So $\alpha I$ is a finitely generated $R$-submodule. 

Conversely, given a finitely generated $R$-submodule $M$ of $K$. Write $M=b_1/a_1R+\cdots+b_n/a_nR$ where $b_i/a_i\in M$. Then $$M=\frac{b_1 \prod_{i\neq1} a_i}{\prod_{i=1}^n a_i}R+\cdots+\frac{b_n \prod_{i\neq n} a_i}{\prod_{i=1}^n a_i}R=\alpha I$$ where $\alpha=1/\prod_{i=1}^n a_i\in K^\times$ and $I=(b_1 \prod_{i\neq1} a_i,\ldots,b_n \prod_{i\neq n} a_i)$ is an ideal in $R$. So $M$ is a fractional ideal in $K$.

\subsection*{Exercise 3.32}

\subsection*{Exercise 3.33}

(a) Clearly, $A^{-1}$ and $A^*$ are both additive subgroups of $L$. If $s\in S$ and $\alpha\in A^{-1}$, then $s\alpha A\sbe S$ as $\alpha A \sbe S$. This means $s\alpha \in A^{-1}$ and so $A^{-1}$ is an $S$-submodule. On the other hand, if $r\in R$ and $\alpha\in A^*$, then $\Tr^L_K (r\alpha a) = r \Tr^L_K(\alpha a) \in R$ for all $a\in A$ as $\Tr^L_K(\alpha a) \in R$. This means $r\alpha \in A^*$ and so $A^*$ is an $R$-submodule.

Now, if $\alpha\in A^{-1} \implies \alpha A\sbe S \implies \Tr^L_K(\alpha A) \sbe R \implies \alpha \in A^*$. So $A^{-1} \sbe A^*$.

(b) $(\Rightarrow)$ Suppose $A=\beta/\alpha \cdot I$ is a fractional ideal where $\alpha,\beta \in S$ and $I$ is an ideal in $S$. For $s\in S$, $sA = s \cdot \beta/\alpha \cdot I \sbe \beta/\alpha \cdot I = A$. And clearly $A \sbe SA$. So $SA=A$. On the other hand, we see that $\alpha A = \beta I \sbe S$ and so $0\neq\alpha\in S$.

$(\Leftarrow)$ Suppose $SA=A$ and there exists $0\neq \alpha \in A^{-1}$. Write $A = 1/\alpha \cdot (\alpha A)$. We check that $\alpha A$ is an ideal in $S$. (So $A$ is a fractional ideal.) Note that since $\alpha \in A^{-1}$ so $\alpha A \sbe S$. Moreover, for any $s\in S$, we have $s(\alpha A) \sbe \alpha SA = \alpha A$.

(c) (i) Suppose $A\subset B$. First, let $\beta \in B^{-1} \implies \beta A \sbe \beta B \sbe S \implies \beta \in A^{-1}$. So $B^{-1} \sbe A^{-1}$. Next, let $\beta \in B^* \implies \Tr^L_K(\beta B) \sbe R \implies \Tr^L_K(\beta A) \sbe R \implies \beta \in A^*$. So $B^* \sbe A^*$.

(ii) From (a) we know $A^* \spe A^{-1}$. So by (i) we have $(A^*)^{-1} = \diff A \sbe (A^{-1})^{-1}$.

(iii) This follows from Exercise 3.31 (b).

(iv) By (ii) and (iii), $\diff I \sbe (I^{-1})^{-1} = I$.

(v) From (b), it's sufficient to show that $S\diff I = \diff I$ and $(\diff I)^{-1} \neq \{0\}$. By (a), we have $S \diff I = S (I^*)^{-1} = (I^*)^{-1} = \diff I$. Moreover, by (i) and (iv), we have $\diff I \sbe I \implies (\diff I)^{-1} \spe I^{-1} \neq \{0\} \implies (\diff I)^{-1} \neq \{0\}$.

(vi) Similar to (v), it's sufficient to show that $S\diff A = \diff A$ and $(\diff A)^{-1} \neq \{0\}$. By (a), we have $S \diff A = S (A^*)^{-1} = (A^*)^{-1} = \diff A$. Moreover, by (i) and (v), $A \sbe I \implies A^* \spe I^* \implies (A^*)^{-1} = \diff A \sbe (I^*)^{-1} = \diff I \implies (\diff A)^{-1} \spe (\diff I)^{-1} \neq \{0\} \implies (\diff A)^{-1} \neq \{0\}$.

(vii) Write $I=\beta J$ where $\beta \in L$ and $J$ is an ideal in $S$. For $s\in S$ and $\alpha \in I^*$, $\Tr^L_K(s\alpha I) = \Tr^L_K(s\alpha \beta J) \sbe \Tr^L_K(\alpha\beta J) = \Tr^L_K(\alpha I) \sbe R$. So $s\alpha \in I^*$.

(viii) We need to check that for any $\alpha \in I^*$, $\alpha \diff I \sbe S$. Let $\beta \in\diff I = (I^*)^{-1} \implies \beta I^* \sbe S \implies \alpha\beta \sbe S$.

(ix) From (b), it's sufficient to show that $SI^* = I^*$ and $(I^*)^{-1} = \diff I \neq \{0\}$. By (vii) we have the former, and by (v) we have the latter.

(x) Let $\alpha \in I$ and $\beta \in I^*$. Then $\Tr^L_K(\alpha\beta S) \sbe R$ as $\alpha \in I$ and $\beta S \sbe I^*$ by (vii). So $\alpha\beta \in S^*$. And by the additivity of trace we have $II^* \sbe S^*$.

Let $\alpha \in I^{-1}$ and $\beta \in S^*$. Then $\Tr^L_K(\alpha\beta I)  = \Tr^L_K(\beta\alpha I) \sbe \Tr^L_K(\beta S) \sbe R$ as $\alpha I \sbe S$ and $\beta \in S^*$. So $\alpha\beta \in I^*$. And by the additivity of trace we have $I^{-1}S^* \sbe I^*$.

(xi) Since both $I^{-1}$ and $S^*$ are fractional ideals by (ix), so from (x) $I^{-1}S^* \sbe I^*$ we have $S^* = II^{-1}S^* \sbe II^* \sbe S^*$. Hence $II^*=S^*$.

(xii) Replace $I$ by $I^*$ in (xi) and done. (By (ix) we know $I^*$ is a fractional ideal so this is legitimate.)

(xiii) By (xi) and (xii) we have $II^* = I^*(I^*)^*$. Multiplying $(I^*)^{-1}$ gives us $I=(I^*)^*$.

(xiv) $I \diff S = I(S^*)^{-1} = I(II^*)^{-1} = II^{-1}(I^*)^{-1} = \diff I$. (We've used (xi).)

\subsection*{Exercise 3.34}

(a) Since $\alpha_1,\ldots,\alpha_n$ are linearly independent, so by Exercise 2.23 (a), we have the matrix $T := \Tr^L_K(\alpha_i\alpha_j) \in \GL_n(K)$ is invertible. Let $C:=[c_{ij}] \in \GL_n(K)$ be its inverse, then $TC=I_n$.

For each $j=1,\ldots,n$, set $\beta_j:=\sum_{k=1}^n c_{kj}\alpha_k$. Then
$$
	\Tr^L_K(\alpha_i\beta_j)
	= \Tr^L_K \left(\alpha_i \sum_{k=1}^n c_{kj}\alpha_k \right)
	= \sum_{k=1}^n c_{kj} \Tr^L_K(\alpha_i\alpha_k) = [TC]_{ij}
	= \begin{cases}
		1, & i=j. \\
		0, & i\neq j.
	  \end{cases}
$$

We next check that $\beta_1,\ldots,\beta_n$ are linearly independent. Suppose $\sum_{j=1}^n d_j\beta_j = 0$. Then we have
$$
\sum_{j=1}^n d_j\beta_j
= \sum_{j=1}^n d_j \sum_{k=1}^n c_{kj}\alpha_k
=  \sum_{k=1}^n \left( \sum_{j=1}^n d_j c_{kj} \right) \alpha_k
= 0.
$$
Since $\alpha_1,\ldots,\alpha_n$ are linearly independent, so $\sum_{j=1}^n d_j c_{kj} = 0$ for all $k=1,\ldots,n$. This means
$$
C \cdot
\begin{pmatrix}
    d_1 \\
    \vdots \\
    d_n
\end{pmatrix}
=
\begin{pmatrix}
    0 \\
    \vdots \\
    0
\end{pmatrix}.
$$
And since $C$ is invertible, so we have $d_j=0$ for all $j=1,\ldots,n$.

(b) Since $\gamma \in A^*$, we know $\Tr^L_K(\gamma\alpha_j) \in R$ for all $j$. Let $\beta:=\sum_{j=1}^n \Tr^L_K(\gamma\alpha_j)\beta_j \in B$. Then for each $i=1,\ldots,n$,
$$
\Tr^L_K(\beta\alpha_i)
= \Tr^L_K \left( \sum_{j=1}^n \Tr^L_K(\gamma\alpha_j) \beta_j \alpha_i \right)
= \sum_{j=1}^n \Tr^L_K(\gamma\alpha_j) \Tr^L_K(\beta_j \alpha_i )
= \Tr^L_K(\gamma\alpha_i).
$$
(We've used (a) in the last equality.) This implies $\Tr^L_K((\gamma-\beta)\alpha_i) = 0$ for all $i=1,\ldots,n$.

Now, write $\gamma-\beta = \sum_{j=1}^n k_j\alpha_j$ where $k_j\in K$. We claim that all $k_j=0$. Note that for each $i=1,\ldots,n$, we have
$$
0
= \Tr^L_K((\gamma-\beta)\alpha_i)
=  \Tr^L_K \left(\sum_{j=1}^n k_j\alpha_j \alpha_i\right)
= \sum_{j=1}^n k_j \Tr^L_K(\alpha_j\alpha_i).
$$
This means
$$
T \cdot
\begin{pmatrix}
    k_1 \\
    \vdots \\
    k_n
\end{pmatrix}
=
\begin{pmatrix}
    0 \\
    \vdots \\
    0
\end{pmatrix}.
$$
And since $T$ is invertible, so we have $k_j=0$ for all $j=1,\ldots,n$, as desired.

The above shows that $\gamma = \beta \in B$ and so $A^* \sbe B$. On the other hand, for each $\beta_j \in B$, we see that $\Tr^L_K(\beta_j A) = \Tr^L_K(\beta_j (\oplus R\alpha_i)) \sbe R$. This implies $\beta_j\in A^*$ for all $j=1,\ldots,n$ and so $B\sbe A^*$. Hence, $A^*=B$.

\subsection*{Exercise 3.35}

(a) Since $f(x)\in K[x]$ and $f(x)=(x-\alpha)g(x)$, so for each $i$, $\sigma_i(f(x)) = f(x) = (x-\sigma_i(\alpha))(\sigma_i(g(x))) = (x-\alpha_i)g_i(x)$.

(b) Differentiating both sides of (a) gives us $f'(x) = g_i(x) + (x-\alpha_i)g_i'(x)$. So we have
$$
f'(\alpha_j) = g_i(\alpha_j) + (\alpha_j-\alpha_i)g_i'(\alpha_j).
$$

Case 1: Suppose $i\neq j$. From Exercise 2.20 we know $f'(\alpha_j) = \prod_{k\neq j} (\alpha_j-\alpha_k)$. On the other hand, since $g_i(x) = \prod_{k\neq i} (x-\alpha_k)$, we have $g_i'(x) = \sum_{l\neq i} \prod_{k\neq i,l} (x-\alpha_k)$ and so $(x-\alpha_i)g_i'(x) = \sum_{l\neq i} \prod_{k\neq l} (x-\alpha_k)$.

Plugging $x=\alpha_j$ gives us
$$
(\alpha_j-\alpha_i) g_i'(\alpha_j)
= \sum_{l\neq i} \prod_{k\neq l} (\alpha_j-\alpha_k)
= \prod_{k\neq j} (\alpha_j-\alpha_k)
= f'(\alpha_j).
$$
This implies that $g_i(\alpha_j) = 0$.

Case 2: If $i=j$. Then it's easy to see that $f'(\alpha_j) = g_i(\alpha_j) + (\alpha_j-\alpha_i)g_i'(\alpha_j) = g_i(\alpha_j)$.

(c) Write $NM=[c_{ij}]$. Then
$$
c_{ij}
= \sum_{k=1}^n \sigma_i\left( \frac{\gamma_{k-1}}{f'(\alpha)} \right) \alpha_j^{k-1}
= \frac{1}{ \sigma_i(f'(\alpha)) } \cdot \sum_{k=1}^n \sigma_i(\gamma_{k-1}) \alpha_j^{k-1}
= \frac{ g_i(\alpha_j) }{ f'(\alpha_i) }
=
\begin{cases}
		0, & i\neq j \\
		1, & i = j
\end{cases}
$$
by (b). So $NM=I_n$ is the identity matrix.

From linear algebra, this implies $MN=I_n$ is also the identity matrix. By considering its $ij$-entry, we have
$$
\sum_{k=1}^n \alpha_k^{i-1}\sigma_k \left( \frac{\gamma_{j-1}}{f'(\alpha)} \right)
= \sum_{k=1}^n \sigma_k \left( \frac{ \alpha^{i-1} \gamma_{j-1} }{ f'(\alpha) } \right)
= \Tr^L_K \left( \alpha^{i-1} \cdot \frac{\gamma_{j-1}}{f'(\alpha)} \right)
=
\begin{cases}
		0, & i\neq j. \\
		1, & i = j.
\end{cases}
$$
Since $\{1,\alpha,\ldots,\alpha^{n-1}\}$ is a basis of $L$ over $K$. So by the definition given in Exercise 3.34 (a), $\{\gamma_0/f'(\alpha),\ldots,\gamma_{n-1}/f'(\alpha)\}$ is the dual basis to $\{1,\alpha,\ldots,\alpha^{n-1}\}$.

(d) Since $\alpha\in S$ is integral over $R$, so similar to Theorem 1 (p. 10) we know $f(x)\in R[x]$. We will check inductively that $\gamma_{n-1},\ldots,\gamma_0 \in R[\alpha]$. Since $f(x) = (x-\alpha)(\gamma_0+\cdots+\gamma_{n-1}x^{n-1})$, by comparing the coefficient of $x^n$, we have $\gamma_{n-1} = 1 \in R[\alpha]$. Next, by comparing the coefficient of $x^{n-1}$, we have $\gamma_{n-2}-\gamma_{n-1}\alpha \in R$ and so $\gamma_{n-2} \in R[\alpha]$. Inductively, one sees easily that $\gamma_{n-1},\ldots,\gamma_0 \in R[\alpha]$. This shows $R\gamma_0 + \cdots + R\gamma_{n-1} \sbe R[\alpha]$.

Conversely, we note that by Exercise 3.34 (a), the dual basis $\{\gamma_0/f'(\alpha),\ldots,\gamma_{n-1}/f'(\alpha)\}$ is linearly independent over $K$. Hence so is $\{\gamma_0,\ldots,\gamma_{n-1}\}$. This shows that the $R$-module generated by $\gamma_0,\ldots,\gamma_{n-1}$ is free of rank $n$. So we have $R\gamma_0 + \cdots + R\gamma_{n-1} = R[\alpha]$. 

(e) By Exercise 3.34 (b), we know $R[\alpha]^* = R\gamma_0/f'(\alpha) + \cdots + R\gamma_{n-1}/f'(\alpha)$. So by (d) we have $R[\alpha]^* = R[\alpha]/f'(\alpha)$.

(f) From (e) we have $\diff R[\alpha] = (R[\alpha]/f'(\alpha))^{-1} = \{ \beta \in L \mid \beta \cdot R[\alpha]/f'(\alpha) \sbe S\}$. We check that this is $f'(\alpha)S$. If $ \beta \in L$ s.t. $\beta \cdot R[\alpha]/f'(\alpha) \sbe S$. Then in particular we have $\beta/f'(\alpha) \in S$ and so $\beta \in f'(\alpha)S$. Conversely, we see that $f'(\alpha)s \cdot R[\alpha]/f'(\alpha) = sR[\alpha] \sbe S$ for all $s\in S$. So we are done.

(g) From (f) and Exercise 3.33 (c) (i), we have $f'(\alpha)S = \diff R[\alpha] \sbe \diff S$. So in particular $f'(\alpha) \in \diff S$.

\subsection*{Exercise 3.36}

\begin{comment}
(a) It's sufficient to check that $\alpha_1,\ldots,\alpha_n$ are linearly independent over $K$. If not, then there exist $c_1,\ldots,c_n \in K$ not all zero s.t. $\sum c_i\alpha_i = 0$. By Exercise 2.25, we take $0 \neq m\in\ZZ$ s.t. $mc_i\in R$ for all $i$. Then $\sum mc_i\alpha_i = 0$. Since $\alpha_1,\ldots,\alpha_n$ are linearly independent mod $P$, so by considering mod $PS$ we have $mc_i \in P$ for all $i$.

Now, with the notation as in the Lemma of Theorem 22 (b) (p. 48), we set $A=P$ and $B=(mc_1,\ldots,mc_n) \neq 0$. Then there exists $\gamma\in K$ s.t. $\gamma B\subset R$ and $\gamma B\not\subset A=P$. So we have all $\gamma mc_i \in R$ but there's some $\gamma mc_{i_0} \notin P$. But by considering the equation $\sum \gamma mc_i\alpha_i = 0$ mod $PS$, we have $\gamma mc_i \in P$ for all $i$, a contradiction.
\end{comment}

\subsection*{Exercise 3.37}

\subsection*{Exercise 3.38}

\subsection*{Exercise 3.39}

\subsection*{Exercise 3.40}

\subsection*{Bonus 3.1}

We fill in the details in the proof of Theorem 22 (b) (p. 48) that the $\beta_i$ need not all be in $P$. So far, we've found some $\beta_1,\ldots,\beta_{n+1}\in R$ s.t. $\beta_1\alpha_1+\cdots+\beta_{n+1}\alpha_{n+1}=0$. If one of the $\beta_i\notin P$ then we are done. So we assume all $\beta_i\in P$. 

Set $A=P,B=(\beta_1,\ldots,\beta_{n+1})=\beta_1R+\cdots+\beta_{n+1}R$. Then by the Lemma (in the same page), $\exists \gamma\in K$ s.t. $\gamma B\subset R$ and $\gamma B\not\subset A=P$. So there exists $\gamma\beta_i\notin P$ for some $i$. Hence we have $(\gamma\beta_1)\alpha_1+\cdots+(\gamma\beta_i)\alpha_i+\cdots+(\gamma\beta_{n+1})\alpha_{n+1}=0$. All coefficients are now in $R$ because $\gamma B\subset R$, and there's (at least) one that is not in $P$, namely, $\gamma\beta_i$.

\subsection*{Bonus 3.2}

We describe the prime ideals involved in the factorizations in Theorem 25 (p. 52) as principal ideals.

For $m=-1$. No primes divide $m$, so the first case doesn't occur. And when $p=2$, since $2=(1+i)(1-i)$, we have $(2,1+i)=(1+i)$.

Now assume $p$ is odd and $n^2\equiv -1 \pmod{p}$ for some $n\in\ZZ$. So $p\mid n^2+1=(n+i)(n-i)$. From Exercise 1.8(b) we know $p$ is reducible in $\ZZ[i]$. Moreover, by considering the norm it's easy to see that $p$ can only be factored into two irreducible elements (thus, prime elements, because we're working in PID). Write $p=\alpha\beta$, then $\alpha,\beta\mid(n+i)(n-i)$. So they must divide $n+i$ or $n-i$. Note that they cannot divide the same one, otherwise we would have $p$ divides that element.

WLOG, say $\alpha\mid n+i$ and $\beta\mid n-i$ where $p=\alpha\beta$ is a product of irreducible elements. We claim that $(p,n+i)=(\alpha)$ and $(p,n-i)=(\beta)$. $\sbe$ is clear by the selection of $\alpha,\beta$. Moreover, $\spe$ follows from the Bzout's identity. (Also note that since $p$ is clearly not a square in $\ZZ[i]$, so $\alpha\nsim\beta$. This means the two principal ideals are indeed distinct.)

For $m=-3$. When $p\mid -3$ (so $p=3$), since $3=(\sqrt{-3})(-\sqrt{-3})$, we have $(3,\sqrt{-3})=(-\sqrt{-3})$. On the other hand, the case where $p$ is odd and $n^2\equiv -3 \pmod{p}$ for some $n\in\ZZ$ is very similar to the case in $m=-1$. We skip the details.

\subsection*{Bonus 3.3}

We give a new proof of Theorem 25 (p. 52) by using Theorem 27 (p. 55) and its following remark (p. 57). (Using the same notation in Theorem 27.)

(a) Suppose $p\mid m$. Set $\alpha=\sqrt{m}$. 

Case 1: $p=2$, then $m\equiv 2 \pmod{4}$. $S=\ZZ[\sqrt{m}]=R[\alpha]$. So $2\nmid \#(S/R[\alpha])=1$. Since $g=x^2-m$, we have $\ovl{g}=x^2\in(\ZZ/2\ZZ)[x]$ and hence $2S=(2,\sqrt{m})^2$.

Case 2: $p$ is odd. Note that $\disc(\alpha)=\disc(1,\sqrt{m})=4m$ and since $m$ is square-free, $p^2\nmid 4m$. So we can use Theorem 27 again and by similar argument to (a) we get $pS=(p,\sqrt{m})^2$.

(b) Suppose $p=2$ and $m$ is odd.

Case 1: $m\equiv3\pmod{4}$. Set $\alpha=\sqrt{m}$. $S=\ZZ[\sqrt{m}]=R[\alpha]$. So $2\nmid \#(S/R[\alpha])=1$. Since $g=x^2-m$, we have $\ovl{g}=x^2+1=(x+1)^2\in(\ZZ/2\ZZ)[x]$ and hence $2S=(2,1+\sqrt{m})^2$.

Case 2: $m\equiv1\pmod{8}$. Set $\alpha=(1+\sqrt{m})/2$. $S=\ZZ[(1+\sqrt{m})/2]=R[\alpha]$. So $2\nmid \#(S/R[\alpha])=1$. Since $g=x^2-x+(1-m)/4$, we have $\ovl{g}=x^2+x=x(x+1)\in(\ZZ/2\ZZ)[x]$ and hence $2S=(2,(1+\sqrt{m})/2)(2,1+(1+\sqrt{m})/2)=(2,(1+\sqrt{m})/2)(2,(1-\sqrt{m})/2)$.

Case 3: $m\equiv5\pmod{8}$. Set $\alpha=(1+\sqrt{m})/2$. We can use Theorem 27 by the same reason in case 2. Since $g=x^2-x+(1-m)/4$, we have $\ovl{g}=x^2+x+1\in(\ZZ/2\ZZ)[x]$, which is irreducible in $(\ZZ/2\ZZ)[x]$, and hence $2S$ is a prime ideal.

Suppose $p$ is odd and $p\nmid m$.

Case 1: $m\equiv n^2\pmod{p}$. Set $\alpha=\sqrt{m}$. $\disc(\alpha)=\disc(1,\sqrt{m})=4m$ and so $p^2\nmid 4m$. Since $g=x^2-m$, we have $\ovl{g}=x^2-n^2=(x+n)(x-n)\in(\ZZ/p\ZZ)[x]$ and hence $pS=(p,\sqrt{m}+n)(p,\sqrt{m}-n)=(p,n+\sqrt{m})(p,n-\sqrt{m})$.

Case 2: $m$ is not a square mod $p$. Set $\alpha=\sqrt{m}$. We can use Theorem 27 by the same reason in case 1. Since $g=x^2-m$, we have $\ovl{g}=x^2-m\in(\ZZ/p\ZZ)[x]$ is irreducible, and hence $2S$ is a prime ideal.

\end{document}